# è‡ªåŠ¨æ›´æ–°åŠŸèƒ½å®ç°æ€»ç»“

## ğŸ“‹ å·²å®Œæˆçš„å·¥ä½œ

### 1. åç«¯é…ç½® (Rust/Tauri)

âœ… **æ·»åŠ æ›´æ–°å™¨æ’ä»¶ä¾èµ–**
- æ–‡ä»¶: `src-tauri/Cargo.toml`
- æ·»åŠ : `tauri-plugin-updater = "2"`

âœ… **é…ç½®æ›´æ–°å™¨æ’ä»¶**
- æ–‡ä»¶: `src-tauri/tauri.conf.json`
- é…ç½®æ›´æ–°ç«¯ç‚¹ã€å¯¹è¯æ¡†ã€å…¬é’¥ç­‰

âœ… **åˆå§‹åŒ–æ›´æ–°å™¨æ’ä»¶**
- æ–‡ä»¶: `src-tauri/src/lib.rs`
- æ·»åŠ : `.plugin(tauri_plugin_updater::Builder::new().build())`

### 2. å‰ç«¯å®ç° (React/TypeScript)

âœ… **åˆ›å»ºæ›´æ–°æ£€æµ‹ç»„ä»¶**
- æ–‡ä»¶: `src/components/UpdateChecker.tsx`
- åŠŸèƒ½:
  - å¯åŠ¨æ—¶è‡ªåŠ¨æ£€æŸ¥æ›´æ–°
  - æ˜¾ç¤ºæ›´æ–°å¯¹è¯æ¡†
  - ä¸‹è½½è¿›åº¦æ˜¾ç¤º
  - ä¸€é”®æ›´æ–°å®‰è£…

âœ… **é›†æˆåˆ°åº”ç”¨å¸ƒå±€**
- æ–‡ä»¶: `src/components/layout/Layout.tsx`
- æ·»åŠ  `<UpdateChecker />` ç»„ä»¶

âœ… **æ·»åŠ å¿…è¦ä¾èµ–**
- æ–‡ä»¶: `package.json`
- æ·»åŠ :
  - `@tauri-apps/plugin-updater`
  - `@tauri-apps/plugin-process`

### 3. å¼€å‘å·¥å…·

âœ… **Makefile å‘½ä»¤**
- `make generate-keys`: ç”Ÿæˆç­¾åå¯†é’¥å¯¹
- `make sign-update`: ç­¾åæ›´æ–°åŒ…
- æ›´æ–° `make help` å¸®åŠ©ä¿¡æ¯

âœ… **è‡ªåŠ¨åŒ–é…ç½®è„šæœ¬**
- æ–‡ä»¶: `scripts/setup-updater.sh`
- åŠŸèƒ½: ä¸€é”®é…ç½®æ‰€æœ‰æ›´æ–°ç›¸å…³è®¾ç½®

### 4. CI/CD é…ç½®

âœ… **GitHub Actions å·¥ä½œæµ**
- æ–‡ä»¶: `.github/workflows/release-macos.yml`
- é…ç½®è‡ªåŠ¨ç­¾åå’Œå‘å¸ƒ

### 5. æ–‡æ¡£

âœ… **å®Œæ•´é…ç½®æŒ‡å—**
- æ–‡ä»¶: `docs/AUTO_UPDATE.md`
- åŒ…å«è¯¦ç»†çš„é…ç½®æ­¥éª¤å’Œæ•…éšœæ’æŸ¥

âœ… **å¿«é€Ÿå¼€å§‹æŒ‡å—**
- æ–‡ä»¶: `docs/QUICK_START_UPDATE.md`
- 5 åˆ†é’Ÿå¿«é€Ÿé…ç½®æ•™ç¨‹

âœ… **æ›´æ–° README**
- æ–‡ä»¶: `README.md`
- æ·»åŠ è‡ªåŠ¨æ›´æ–°åŠŸèƒ½è¯´æ˜

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### ç”¨æˆ·ä½“éªŒ

- âœ… å¯åŠ¨æ—¶è‡ªåŠ¨æ£€æŸ¥æ›´æ–°
- âœ… å‘ç°æ–°ç‰ˆæœ¬æ—¶å¼¹çª—æç¤º
- âœ… æ˜¾ç¤ºç‰ˆæœ¬å·å’Œæ›´æ–°æ—¥å¿—
- âœ… å®æ—¶ä¸‹è½½è¿›åº¦æ˜¾ç¤º
- âœ… ä¸€é”®ä¸‹è½½å¹¶å®‰è£…
- âœ… æ›´æ–°å®Œæˆè‡ªåŠ¨é‡å¯
- âœ… å¯é€‰æ‹©ç¨åæ›´æ–°

### å¼€å‘è€…ä½“éªŒ

- âœ… ä¸€é”®ç”Ÿæˆç­¾åå¯†é’¥
- âœ… è‡ªåŠ¨åŒ–é…ç½®è„šæœ¬
- âœ… Makefile ç®€åŒ–å‘½ä»¤
- âœ… GitHub Actions è‡ªåŠ¨å‘å¸ƒ
- âœ… è¯¦ç»†çš„æ–‡æ¡£å’ŒæŒ‡å—

### å®‰å…¨æ€§

- âœ… ä½¿ç”¨ç§é’¥ç­¾åæ›´æ–°åŒ…
- âœ… å…¬é’¥éªŒè¯æ›´æ–°åŒ…å®Œæ•´æ€§
- âœ… HTTPS ä¼ è¾“
- âœ… é˜²æ­¢ä¸­é—´äººæ”»å‡»

## ğŸ“¦ æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶
```
src/components/UpdateChecker.tsx          # æ›´æ–°æ£€æµ‹ç»„ä»¶
scripts/setup-updater.sh                  # é…ç½®è„šæœ¬
docs/AUTO_UPDATE.md                       # å®Œæ•´é…ç½®æŒ‡å—
docs/QUICK_START_UPDATE.md                # å¿«é€Ÿå¼€å§‹æŒ‡å—
docs/IMPLEMENTATION_SUMMARY.md            # æœ¬æ–‡ä»¶
```

### ä¿®æ”¹æ–‡ä»¶
```
src-tauri/Cargo.toml                      # æ·»åŠ æ›´æ–°å™¨ä¾èµ–
src-tauri/tauri.conf.json                 # é…ç½®æ›´æ–°å™¨
src-tauri/src/lib.rs                      # åˆå§‹åŒ–æ›´æ–°å™¨
src/components/layout/Layout.tsx          # é›†æˆæ›´æ–°ç»„ä»¶
package.json                              # æ·»åŠ å‰ç«¯ä¾èµ–
Makefile                                  # æ·»åŠ æ›´æ–°ç›¸å…³å‘½ä»¤
.github/workflows/release-macos.yml       # é…ç½®è‡ªåŠ¨ç­¾å
README.md                                 # æ›´æ–°æ–‡æ¡£
```

## ğŸš€ ä½¿ç”¨æµç¨‹

### é¦–æ¬¡é…ç½®

1. è¿è¡Œé…ç½®è„šæœ¬: `./scripts/setup-updater.sh`
2. é…ç½® GitHub Secrets: `TAURI_PRIVATE_KEY`
3. å®‰è£…ä¾èµ–: `pnpm install`

### å‘å¸ƒæ–°ç‰ˆæœ¬

1. æ›´æ–°ç‰ˆæœ¬å·: `make tag-release VERSION=x.x.x`
2. GitHub Actions è‡ªåŠ¨æ„å»ºå’Œå‘å¸ƒ
3. ç”¨æˆ·è‡ªåŠ¨æ”¶åˆ°æ›´æ–°é€šçŸ¥

### ç”¨æˆ·æ›´æ–°

1. å¯åŠ¨åº”ç”¨
2. è‡ªåŠ¨æ£€æµ‹æ›´æ–°
3. ç‚¹å‡»"ç«‹å³æ›´æ–°"
4. è‡ªåŠ¨ä¸‹è½½ã€å®‰è£…ã€é‡å¯

## ğŸ”§ æŠ€æœ¯å®ç°

### æ›´æ–°æ£€æµ‹æµç¨‹

```
åº”ç”¨å¯åŠ¨
  â†“
æ£€æŸ¥æ›´æ–° (check())
  â†“
å‘ç°æ–°ç‰ˆæœ¬ï¼Ÿ
  â”œâ”€ æ˜¯ â†’ æ˜¾ç¤ºé€šçŸ¥å’Œå¯¹è¯æ¡†
  â”‚        â†“
  â”‚      ç”¨æˆ·ç‚¹å‡»"ç«‹å³æ›´æ–°"
  â”‚        â†“
  â”‚      ä¸‹è½½æ›´æ–°åŒ… (downloadAndInstall())
  â”‚        â†“
  â”‚      éªŒè¯ç­¾å
  â”‚        â†“
  â”‚      å®‰è£…æ›´æ–°
  â”‚        â†“
  â”‚      é‡å¯åº”ç”¨ (relaunch())
  â”‚
  â””â”€ å¦ â†’ ç»§ç»­æ­£å¸¸ä½¿ç”¨
```

### ç­¾åéªŒè¯æµç¨‹

```
æ„å»ºåº”ç”¨
  â†“
ä½¿ç”¨ç§é’¥ç­¾å (.sig æ–‡ä»¶)
  â†“
ä¸Šä¼ åˆ° GitHub Release
  â†“
ç”¨æˆ·ä¸‹è½½æ›´æ–°
  â†“
ä½¿ç”¨å…¬é’¥éªŒè¯ç­¾å
  â†“
éªŒè¯é€šè¿‡ï¼Ÿ
  â”œâ”€ æ˜¯ â†’ å®‰è£…æ›´æ–°
  â””â”€ å¦ â†’ æ‹’ç»å®‰è£…
```

## ğŸ“Š é…ç½®æ–‡ä»¶è¯´æ˜

### tauri.conf.json

```json
{
  "plugins": {
    "updater": {
      "active": true,                    // å¯ç”¨æ›´æ–°å™¨
      "endpoints": [                     // æ›´æ–°æ£€æŸ¥ç«¯ç‚¹
        "https://github.com/owner/repo/releases/latest/download/latest.json"
      ],
      "dialog": true,                    // æ˜¾ç¤ºæ›´æ–°å¯¹è¯æ¡†
      "pubkey": "your-public-key"        // å…¬é’¥ï¼ˆç”¨äºéªŒè¯ç­¾åï¼‰
    }
  }
}
```

### latest.json (GitHub Release)

```json
{
  "version": "0.3.0",                    // æœ€æ–°ç‰ˆæœ¬å·
  "notes": "æ›´æ–°å†…å®¹è¯´æ˜",                // æ›´æ–°æ—¥å¿—
  "pub_date": "2024-02-04T12:00:00Z",   // å‘å¸ƒæ—¶é—´
  "platforms": {
    "darwin-x86_64": {                   // macOS Intel
      "signature": "...",                // ç­¾å
      "url": "https://..."               // ä¸‹è½½é“¾æ¥
    },
    "darwin-aarch64": {                  // macOS Apple Silicon
      "signature": "...",
      "url": "https://..."
    }
  }
}
```

## ğŸ“ å­¦ä¹ èµ„æº

- [Tauri Updater å®˜æ–¹æ–‡æ¡£](https://tauri.app/v1/guides/distribution/updater)
- [Tauri Action GitHub](https://github.com/tauri-apps/tauri-action)
- [Tauri Signer æ–‡æ¡£](https://tauri.app/v1/guides/distribution/sign-macos)

## âœ… æµ‹è¯•æ¸…å•

- [ ] ç”Ÿæˆç­¾åå¯†é’¥å¯¹
- [ ] é…ç½®å…¬é’¥åˆ° tauri.conf.json
- [ ] é…ç½® GitHub Secrets
- [ ] æ„å»ºåº”ç”¨
- [ ] ç­¾åæ›´æ–°åŒ…
- [ ] åˆ›å»º GitHub Release
- [ ] ä¸Šä¼  latest.json
- [ ] æµ‹è¯•æ›´æ–°æ£€æµ‹
- [ ] æµ‹è¯•ä¸‹è½½å’Œå®‰è£…
- [ ] æµ‹è¯•è‡ªåŠ¨é‡å¯

## ğŸ› å·²çŸ¥é—®é¢˜

æ— 

## ğŸ”® æœªæ¥æ”¹è¿›

- [ ] æ·»åŠ "æ£€æŸ¥æ›´æ–°"èœå•é¡¹
- [ ] æ”¯æŒé™é»˜æ›´æ–°é€‰é¡¹
- [ ] æ·»åŠ æ›´æ–°å†å²è®°å½•
- [ ] æ”¯æŒå¢é‡æ›´æ–°
- [ ] æ·»åŠ æ›´æ–°å¤±è´¥é‡è¯•æœºåˆ¶
- [ ] æ”¯æŒ Windows å’Œ Linux å¹³å°

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **ç§é’¥å®‰å…¨**: ç§é’¥æ–‡ä»¶ (`~/.tauri/cobalt.key`) å¿…é¡»å¦¥å–„ä¿ç®¡ï¼Œä¸è¦æäº¤åˆ° Git
2. **GitHub Secrets**: ç¡®ä¿ `TAURI_PRIVATE_KEY` æ­£ç¡®é…ç½®
3. **ç‰ˆæœ¬å·**: æ¯æ¬¡å‘å¸ƒå¿…é¡»é€’å¢ç‰ˆæœ¬å·
4. **ç­¾åæ–‡ä»¶**: å¿…é¡»ä¸Šä¼  `.sig` æ–‡ä»¶åˆ° GitHub Release
5. **latest.json**: å¿…é¡»åŒ…å«æ‰€æœ‰å¹³å°çš„ä¸‹è½½é“¾æ¥å’Œç­¾å

## ğŸ‰ æ€»ç»“

è‡ªåŠ¨æ›´æ–°åŠŸèƒ½å·²å®Œå…¨å®ç°å¹¶å¯æŠ•å…¥ä½¿ç”¨ã€‚ç”¨æˆ·æ— éœ€å†æ‰‹åŠ¨è®¿é—® GitHub ä¸‹è½½æ–°ç‰ˆæœ¬ï¼Œå¤§å¤§æå‡äº†ç”¨æˆ·ä½“éªŒã€‚å¼€å‘è€…åªéœ€è¿è¡Œ `make tag-release VERSION=x.x.x`ï¼Œå‰©ä¸‹çš„å·¥ä½œå…¨éƒ¨è‡ªåŠ¨åŒ–å®Œæˆã€‚
